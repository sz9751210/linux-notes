# top

- 用途：顯示進程資訊

## 語法

```shell
top [OPTIONS]
```

## 參數(常用)

| 參數 | 說明                                                                                                                                             |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| -b   | 批次輸出，此模式下無法在top的顯示界面中按下按鍵互動只會吐出純文字的內容，配合`-n`可調整批次執行次數批次自動執行一百次，每秒輸出一次的top輸出範例 |
| -c   | 在top畫面的command欄位中顯示該process啟動時使用的command                                                                                         |
| -d   | 更新時間，格式ss.tt(秒.毫秒)                                                                                                                     |
| -i   | 顯示閒置的process                                                                                                                                |
| -n   | 刷新次數                                                                                                                                         |
| -u   | 顯示某user/uid啟動的process狀況                                                                                                                  |
| -p   | 顯示某個process的使用狀況，可使用,符號來顯示多個pid                                                                                              |

| 互動模式 | 說明                                                                                   |
| -------- | -------------------------------------------------------------------------------------- |
| b        | 高亮顯示當前進行的進程                                                                 |
| B        | 使用粗體                                                                               |
| z        | 彩色模式                                                                               |
| Z        | 設定彩色模式顏色                                                                       |
| f        | 選擇要顯示的欄位                                                                       |
| q        | 退出top命令                                                                            |
| c        | 完全命令模式                                                                           |
| \<space> | 即時更新                                                                               |
| s/d      | 設定更新頻率                                                                           |
| h        | 查看說明                                                                               |
| I        | 切換成顯示 CPU 使用比例/全部 CPU 數量                                                  |
| k        | 終止特定 pid                                                                           |
| L        | 查詢字串，搭配 & 使用                                                                  |
| r        | 重新設定 pid 的 nice value，設定成正的會失去優先度，設成負的則會提高優先度 (需要 sudo) |
| u/U      | 選特定使用者                                                                           |
| W        | 寫入目前設定，                                                                         |
| x        | 欄高亮，選取的欄位會全亮 (要先按 b)                                                    |
| y        | 行高亮，正在執行的程式會亮 (要先按 b)                                                  |
| n/#      | 設定顯示多少任務                                                                       |
| j        | 靠左靠右對齊                                                                           |

| 上方面板 | 說明                        |
| -------- | --------------------------- |
| l        | 顯示/隱藏load avg資訊       |
| t        | 顯示/隱藏task/cpu資訊       |
| m        | 顯示/隱藏memory資訊         |
| 1        | 顯示/隱藏每個單一核心的數值 |


| 排序 | 說明                    |
| ---- | ----------------------- |
| P    | 按照cpu使用率排序       |
| M    | 按照memory使用率排行    |
| N    | 按照PID排序             |
| T    | 按照執行時間(TIME+)排行 |
| >/<  | 排列欄位向左向右切換    |
| R    | 反向排序                |


## 欄位說明
```shell
第一行:top - 15:08:41 up  1:32,  2 users,  load average: 0.01, 0.07, 0.06
第二行:Tasks: 137 total,   1 running, 136 sleeping,   0 stopped,   0 zombie
第三行:%Cpu(s):  0.3 us,  0.7 sy,  0.0 ni, 99.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
第四行:KiB Mem :  1882072 total,   538160 free,   678940 used,   664972 buff/cache
第五行:KiB Swap:  2097148 total,  2097148 free,        0 used.  1043904 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
 1872 alan      20   0  926152 108796  18924 S  0.7  5.8   1:12.98 node
 1029 root      20   0  216400   3716   2756 S  0.3  0.2   0:00.37 rsyslogd
 1798 alan      20   0  891568  52492  17456 S  0.3  2.8   0:09.15 node
    1 root      20   0  128076   6716   4184 S  0.0  0.4   0:01.27 systemd
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd
    4 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:0H
```

### 第一行

說明:任務隊列信息，同uptime命令的執行結果

| 參數                           | 說明                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| 15:08:41                       | 當前系統時間                                                 |
| 1:32                           | 系統已經運行了1小時32分（無重啟）                            |
| 2 users                        | 當前有2個用戶登錄系統                                        |
| load average: 0.01, 0.07, 0.06 | load average後面的三個數分別是1分鐘、5分鐘、15分鐘的負載情況 |


>load average數據是每隔5秒鐘檢查一次活躍的進程數，然後按特定算法計算出的數值。如果這個數除以邏輯CPU的數量，結果高於5的時候就表明系統在超負荷運轉了。

### 第二行

說明:Tasks 任務（進程)

| 參數         | 說明       |
| ------------ | ---------- |
| 137 total    | 總進程     |
| 1 running    | 運行中     |
| 136 sleeping | 休眠       |
| 0 stopped    | 停止狀態   |
| 0 zombie     | zombie狀態 |

### 第三行

說明:cpu狀態信息

| 參數    | 說明                                         |
| ------- | -------------------------------------------- |
| 0.3 us  | 用戶空間佔用CPU的百分比                      |
| 0.7 sy  | 內核空間佔用CPU的百分比                      |
| 0.0 ni  | 改變過優先級的進程佔用CPU的百分比            |
| 99.0 id | 空閒CPU百分比                                |
| 0.0 wa  | IO等待佔用C​​PU的百分比                      |
| 0.0 hi  | 硬中斷（Hardware IRQ）佔用CPU的百分比        |
| 0.0 si  | 軟中斷（Software Interrupts）佔用CPU的百分比 |
| 0.0 st  |                                              |

### 第四行

說明:內存狀態

| 參數              | 說明                   |
| ----------------- | ---------------------- |
| 1882072 total     | 物理內存總量(1.8G)     |
| 538160 free       | 使用中的內存總量(0.5G) |
| 678940 used       | 空閒內存總量(0.6G)     |
| 664972 buff/cache | 緩存的內存量(0.6G)     |

### 第五行

說明:swap交換分區訊息

| 參數              | 說明             |
| ----------------- | ---------------- |
| 2097148 total     | 交換區總量       |
| 2097148 free      | 空閒交換區總量   |
| 0 used            | 使用的交換區總量 |
| 1043904 avail Mem | 緩衝的交換區總量 |

## 基本操作
1. 顯示進程訊息
```shell
top
```

2. 顯示完整命令
```shell
top -c
```

3. 以批處理方式搭配執行次數100次，每秒輸出一次top
```shell
top -b -n 100 -d 1.0
```

4. 顯示閒置process
```shell
top -i
```

5. 顯示特定使用者process使用狀況
```shell
top -u root or top -u 0
```

6. 顯示多個pid使用狀況
```shell
top -p 1000,1001,1002
```

7. 設定要顯示的欄位
```shell
top
f
# 進入之後操作
d:設定顯示
方向鍵右鍵:排序(用上下鍵)
方向鍵左件:取消排序
esc/q:離開設定欄位
```

8. 透過互動模式高亮顯示cpu排序
```shell
top
P
b
x
y
```

## 參考資料
* https://www.runoob.com/linux/linux-comm-top.html
* http://www.j4.com.tw/web-design/linux-top-%E5%8F%83%E6%95%B8%E5%8F%8A%E6%8C%87%E4%BB%A4%E7%AD%86%E8%A8%98/
* https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/top.html
* https://tigercosmos.xyz/post/2020/04/unix/top-usage/#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99
## 相關指令
* ps